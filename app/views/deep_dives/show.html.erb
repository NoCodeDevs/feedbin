<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Deep Dive: <%= @topic %> - The Feed</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Newsreader:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #000; --surface: #0a0a0a; --surface-2: #141414;
      --text: #fff; --text-2: #e5e5e5; --text-3: #a3a3a3; --text-4: #737373;
      --accent: #7c3aed; --accent-2: #8b5cf6; --border: #262626;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
    .header { position: sticky; top: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); padding: 16px 32px; }
    .header-inner { max-width: 900px; margin: 0 auto; display: flex; align-items: center; gap: 20px; }
    .logo { font-family: 'Newsreader', serif; font-size: 24px; font-weight: 600; color: var(--text); text-decoration: none; }
    .back { color: var(--text-3); text-decoration: none; margin-left: auto; font-size: 14px; }
    .back:hover { color: var(--text); }
    .main { max-width: 900px; margin: 0 auto; padding: 48px 32px; }
    .badge { display: inline-block; padding: 6px 14px; background: rgba(124,58,237,0.2); border: 1px solid rgba(124,58,237,0.4); border-radius: 999px; font-size: 12px; font-weight: 600; color: var(--accent-2); margin-bottom: 20px; }
    h1 { font-family: 'Newsreader', serif; font-size: 42px; font-weight: 500; margin-bottom: 12px; }
    .meta { color: var(--text-4); font-size: 14px; margin-bottom: 32px; }
    .section { margin-bottom: 40px; }
    .section-title { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-4); margin-bottom: 16px; border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    .summary { font-size: 18px; line-height: 1.8; color: var(--text-2); }
    .points { list-style: none; }
    .points li { padding: 12px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 10px; font-size: 15px; color: var(--text-2); }
    .player { padding: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 12px; }
    .player-name { font-weight: 600; margin-bottom: 4px; }
    .player-role { font-size: 13px; color: var(--accent-2); margin-bottom: 6px; }
    .player-recent { font-size: 14px; color: var(--text-3); }
    .article { display: block; padding: 14px; background: var(--surface-2); border-radius: 10px; margin-bottom: 10px; text-decoration: none; }
    .article:hover { background: var(--surface); }
    .article-title { font-size: 15px; color: var(--text); margin-bottom: 4px; }
    .article-source { font-size: 12px; color: var(--accent-2); }
    .topics { display: flex; flex-wrap: wrap; gap: 8px; }
    .topic { padding: 8px 14px; background: var(--surface-2); border: 1px solid var(--border); border-radius: 999px; font-size: 13px; color: var(--text-2); text-decoration: none; }
    .topic:hover { background: var(--surface); color: var(--text); }
    .empty { text-align: center; padding: 80px 20px; }
    .empty h2 { font-size: 24px; margin-bottom: 12px; }
    .empty p { color: var(--text-3); margin-bottom: 20px; }
    .empty a { display: inline-block; padding: 12px 24px; background: var(--accent); border-radius: 10px; color: #fff; text-decoration: none; }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-inner">
      <a href="/" class="logo">The Feed</a>
      <a href="/" class="back">‚Üê Back to Browse</a>
    </div>
  </header>

  <main class="main">
    <% if @deep_dive["error"] || @deep_dive[:error] %>
      <div class="empty">
        <h2>Not Enough Coverage</h2>
        <p><%= @deep_dive["error"] || @deep_dive[:error] %></p>
        <a href="/">Browse All Articles</a>
      </div>
    <% else %>
      <div class="badge">Deep Dive</div>
      <h1><%= @topic %></h1>
      <p class="meta"><%= @deep_dive["article_count"] || @deep_dive[:article_count] %> articles analyzed</p>

      <% if (@deep_dive["summary"] || @deep_dive[:summary]).present? %>
        <div class="section">
          <div class="section-title">Overview</div>
          <p class="summary"><%= @deep_dive["summary"] || @deep_dive[:summary] %></p>
        </div>
      <% end %>

      <% points = @deep_dive["key_points"] || @deep_dive[:key_points] || [] %>
      <% if points.any? %>
        <div class="section">
          <div class="section-title">Key Points</div>
          <ul class="points">
            <% points.each do |point| %>
              <li><%= point %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% players = @deep_dive["key_players"] || @deep_dive[:key_players] || [] %>
      <% if players.any? %>
        <div class="section">
          <div class="section-title">Key Players</div>
          <% players.each do |player| %>
            <div class="player">
              <div class="player-name"><%= player["name"] || player[:name] %></div>
              <div class="player-role"><%= player["role"] || player[:role] %></div>
              <div class="player-recent"><%= player["recent"] || player[:recent] %></div>
            </div>
          <% end %>
        </div>
      <% end %>

      <% articles = @deep_dive["key_articles"] || @deep_dive[:key_articles] || [] %>
      <% if articles.any? %>
        <div class="section">
          <div class="section-title">Must-Read Articles</div>
          <% articles.each do |article| %>
            <a href="<%= article["url"] || article[:url] %>" target="_blank" class="article">
              <div class="article-title"><%= article["title"] || article[:title] %></div>
              <div class="article-source"><%= article["source"] || article[:source] %></div>
            </a>
          <% end %>
        </div>
      <% end %>

      <% topics = @deep_dive["related_topics"] || @deep_dive[:related_topics] || [] %>
      <% if topics.any? %>
        <div class="section">
          <div class="section-title">Related Topics</div>
          <div class="topics">
            <% topics.each do |topic| %>
              <a href="/deep-dive/<%= CGI.escape(topic) %>" class="topic"><%= topic %></a>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </main>
</body>
</html>
