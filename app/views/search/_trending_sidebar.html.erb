<aside class="trending-sidebar">
  <div class="trending-sidebar-title">Trending This Week</div>
  <nav class="trending-nav">
    <% if @trending_topics.present? %>
      <% @trending_topics.each do |topic| %>
        <% search_query = topic[:keywords]&.first || topic[:name] %>
        <a href="#" class="trending-item <%= 'active' if @query == search_query %>" data-topic="<%= search_query %>" onclick="analyzeTopic(event, '<%= CGI.escape(search_query) %>')">
          <span class="trending-emoji"><%= topic[:emoji] %></span>
          <div class="trending-content">
            <div class="trending-name"><%= topic[:name] %></div>
            <div class="trending-meta">
              <span class="trending-count"><%= topic[:total] %> articles</span>
              <span class="trending-sparkline">
                <%
                  data = topic[:sparkline] || []
                  unless data.blank? || data.all?(&:zero?)
                    width = 50
                    height = 14
                    max_val = [data.max, 1].max
                    points = data.each_with_index.map do |val, i|
                      x = (i.to_f / [data.size - 1, 1].max) * width
                      y = height - ((val.to_f / max_val) * (height - 2)) - 1
                      "#{x.round(1)},#{y.round(1)}"
                    end.join(" ")
                %>
                <svg viewBox="0 0 <%= width %> <%= height %>">
                  <polyline fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" points="<%= points %>"/>
                </svg>
                <% end %>
              </span>
            </div>
          </div>
          <% if topic[:trend] == "rising" %>
            <span class="trending-badge rising">Hot</span>
          <% end %>
        </a>
      <% end %>
    <% else %>
      <div class="trending-empty">Analyzing trends...</div>
    <% end %>
  </nav>

</aside>
